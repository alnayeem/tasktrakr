# PWA Deployment Guide

This guide covers deploying TaskTrakr as a Progressive Web App (PWA) that can be installed on Android and iOS devices.

---

## What is a PWA?

A Progressive Web App is a web application that can be installed on devices and works like a native app:
- **Installable**: Add to home screen on Android/iOS
- **Offline support**: Works without internet (with cached data)
- **App-like experience**: Full-screen, no browser UI
- **Cross-platform**: One codebase for all devices

---

## Current PWA Configuration

| Setting | Value |
|---------|-------|
| App Name | TaskTrakr - AI Goal Tracker |
| Short Name | TaskTrakr |
| Theme Color | #2196F3 (Primary Blue) |
| Background Color | #FAFAFA (Light) |
| Display Mode | Standalone |
| Orientation | Portrait |
| Offline Strategy | Offline-First |

---

## Building the PWA

### Standard Build

```bash
# Build with offline-first caching
flutter build web --release --pwa-strategy offline-first

# Output: build/web/
```

### Build Options

| Flag | Description |
|------|-------------|
| `--pwa-strategy offline-first` | Cache assets for offline use (recommended) |
| `--pwa-strategy none` | No service worker caching |
| `--base-href /app/` | Set base URL if not hosting at root |
| `--wasm` | Use WebAssembly for better performance |

### WebAssembly Build (Better Performance)

```bash
flutter build web --release --wasm --pwa-strategy offline-first
```

---

## Deployment Options

### Option 1: Firebase Hosting (Recommended)

**Cost**: Free tier available (10GB storage, 360MB/day transfer)

```bash
# Install Firebase CLI
npm install -g firebase-tools

# Login to Firebase
firebase login

# Initialize project
firebase init hosting

# Select options:
# - Public directory: build/web
# - Single-page app: Yes
# - Overwrite index.html: No

# Deploy
firebase deploy --only hosting
```

**Result**: `https://your-project.web.app`

### Option 2: Cloudflare Pages (Free)

**Cost**: Free (unlimited bandwidth)

1. Push code to GitHub
2. Go to [Cloudflare Pages](https://pages.cloudflare.com/)
3. Connect your repository
4. Configure build:
   - Build command: `flutter build web --release --pwa-strategy offline-first`
   - Output directory: `build/web`
5. Deploy

**Result**: `https://your-project.pages.dev`

### Option 3: Vercel (Free)

**Cost**: Free tier available

```bash
# Install Vercel CLI
npm install -g vercel

# Deploy
cd build/web
vercel
```

Or connect GitHub repo to Vercel dashboard.

**Result**: `https://your-project.vercel.app`

### Option 4: Netlify (Free)

**Cost**: Free tier available

1. Drag and drop `build/web` folder to [Netlify Drop](https://app.netlify.com/drop)

Or connect GitHub:
- Build command: `flutter build web --release`
- Publish directory: `build/web`

**Result**: `https://your-project.netlify.app`

### Option 5: GitHub Pages (Free)

```bash
# Build with base href for GitHub Pages
flutter build web --release --base-href /niyyah/

# Deploy to gh-pages branch
cd build/web
git init
git add .
git commit -m "Deploy PWA"
git branch -M gh-pages
git remote add origin https://github.com/username/niyyah.git
git push -f origin gh-pages
```

**Result**: `https://username.github.io/niyyah/`

---

## Installing the PWA

### On Android

1. Open the PWA URL in Chrome
2. Tap the menu (⋮) → "Add to Home screen"
3. Or wait for the "Install" banner

**Note**: Chrome will automatically prompt users to install if PWA criteria are met.

### On iOS (Safari)

1. Open the PWA URL in Safari
2. Tap the Share button (↑)
3. Scroll down and tap "Add to Home Screen"
4. Name it and tap "Add"

**iOS Limitations**:
- Must use Safari (Chrome on iOS doesn't support PWA install)
- Push notifications not supported
- Limited background sync
- Storage limited to ~50MB

---

## PWA Requirements Checklist

For the best PWA experience, ensure:

- [x] **HTTPS**: Must be served over HTTPS (all hosting options above provide this)
- [x] **Web Manifest**: `manifest.json` with name, icons, theme_color
- [x] **Service Worker**: Generated by Flutter build
- [x] **Icons**: 192x192 and 512x512 PNG icons
- [x] **Maskable Icons**: For Android adaptive icons
- [ ] **Screenshots**: Add to manifest for richer install UI (optional)

---

## Testing the PWA

### Local Testing

```bash
# Build
flutter build web --release --pwa-strategy offline-first

# Serve locally with HTTPS (required for PWA features)
npx serve build/web

# Or use Python
cd build/web && python3 -m http.server 8000
```

### Chrome DevTools Audit

1. Open Chrome DevTools (F12)
2. Go to **Lighthouse** tab
3. Select "Progressive Web App"
4. Click "Generate report"

### Checking PWA Installability

1. Open Chrome DevTools
2. Go to **Application** tab
3. Check "Manifest" section for errors
4. Check "Service Workers" section

---

## Offline Behavior

With `--pwa-strategy offline-first`:

| Asset Type | Behavior |
|------------|----------|
| App shell (HTML, JS, CSS) | Cached, works offline |
| Flutter assets | Cached on first load |
| API calls | Need custom handling |
| User data | Stored in Hive (IndexedDB) |

**Note**: TaskTrakr already uses Hive for local storage, which works offline in the browser via IndexedDB.

---

## Custom Domain Setup

### Firebase Hosting

```bash
firebase hosting:sites:create your-domain
```

Then add DNS records as instructed.

### Cloudflare Pages

1. Go to project settings → Custom domains
2. Add your domain
3. Update DNS nameservers to Cloudflare

---

## PWA vs Native App Comparison

| Feature | PWA | Native (Flutter) |
|---------|-----|------------------|
| Installation | Via browser | Via App Store |
| Size | ~5MB | ~45MB |
| Offline | Yes (limited) | Full |
| Push Notifications | Android only | Yes |
| Device APIs | Limited | Full access |
| Updates | Instant | Store review |
| Discoverability | SEO + direct URL | App Store search |

---

## Recommended Deployment Strategy

For TaskTrakr launch:

1. **Primary**: Native apps on Play Store + App Store
2. **Secondary**: PWA for:
   - Users who don't want to install
   - Quick sharing via URL
   - Web-based access
   - Countries with slow app store access

---

## Quick Deploy Commands

```bash
# Build PWA
flutter build web --release --pwa-strategy offline-first

# Deploy to Firebase (after setup)
firebase deploy --only hosting

# Deploy to Vercel (after setup)
cd build/web && vercel --prod

# Local test server
npx serve build/web
```

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| PWA not installable | Check HTTPS, manifest.json, icons |
| Service worker not updating | Clear browser cache, hard refresh |
| iOS not showing install prompt | iOS doesn't show prompts; use Share → Add to Home Screen |
| Offline not working | Check service worker in DevTools → Application |
| Icons not showing | Verify paths in manifest.json |

---

## Resources

- [Flutter Web Deployment](https://docs.flutter.dev/deployment/web)
- [PWA Builder](https://www.pwabuilder.com/) - Test and enhance your PWA
- [Lighthouse](https://developers.google.com/web/tools/lighthouse) - PWA auditing
- [web.dev PWA Guide](https://web.dev/progressive-web-apps/)
